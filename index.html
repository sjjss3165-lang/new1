<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›»æ©Ÿç§‘æ™ºæ…§é»é¤ç³»çµ± - è¯ç¶²å®Œå…¨é«”</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root { --primary-cyan: #0891b2; --primary-purple: #7e22ce; --bg-light: #f8fafc; }
        body { font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; background-color: var(--bg-light); margin: 0; padding: 10px; color: #1e293b; }
        .container { max-width: 1200px; margin: 0 auto; padding-bottom: 80px; }
        h1 { text-align: center; font-weight: 900; margin: 20px 0; }
        .store-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 10px; margin-bottom: 25px; }
        .store-card { padding: 12px; border: 2px solid #e2e8f0; border-radius: 12px; background: #fff; cursor: pointer; text-align: center; font-size: 0.9rem; }
        .store-card.active { border-color: var(--primary-purple); background: #fdf4ff; border-width: 3px; }
        .data-stats-box { background: #fff; border: 2.5px solid var(--primary-purple); border-radius: 25px; padding: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .main-flex { display: flex; flex-wrap: wrap; gap: 20px; }
        .control-panel { flex: 1; min-width: 300px; background: #f1f5f9; padding: 25px; border-radius: 20px; }
        .display-panel { flex: 2; min-width: 300px; display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; }
        .stats-list-card { background: white; border: 1px solid #ddd; padding: 15px; border-radius: 12px; position: relative; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        select, input { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #cbd5e1; margin-bottom: 10px; background: white; font-size: 1rem; box-sizing: border-box; }
        .custom-input-group { background: #e2e8f0; padding: 10px; border-radius: 10px; margin-bottom: 15px; border: 1px dashed #64748b; }
        .total-banner { color: #fff; font-size: 1.8rem; font-weight: 900; text-align: center; margin-top: 20px; background: #000; padding: 15px; border-radius: 15px; }
        .qr-section { text-align: center; margin-top: 40px; padding: 20px; border: 2px dashed #ccc; border-radius: 20px; background: #fff; }
        #hostOnlyControls { margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 15px; }
        .footer-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: #1e293b; color: white; padding: 15px; display: flex; justify-content: space-around; align-items: center; z-index: 1000; }
        .notice { font-size: 0.85rem; color: #ef4444; margin-bottom: 10px; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h1>é›»æ©Ÿç§‘æ™ºæ…§é»é¤çµ±è¨ˆç³»çµ± ğŸ©</h1>

    <div id="hostOnlyControls">
        <p style="font-weight:bold; color:var(--primary-purple);">ğŸ› ï¸ ä¸»æ©Ÿæ§åˆ¶ç«¯ï¼šè«‹é¸å®šä»Šæ—¥åº—å®¶ (æ‰‹æ©Ÿç«¯å°‡è‡ªå‹•åŒæ­¥èœå–®)</p>
        <div class="store-grid" id="storeSelector"></div>
    </div>

    <div class="data-stats-box">
        <div class="main-flex">
            <div class="control-panel">
                <h3 id="targetStoreTitle" style="color:var(--primary-cyan); margin-top:0;">åŒæ­¥è³‡æ–™ä¸­...</h3>
                <p class="notice">ğŸ’¡ é£²æ–™å‚™è¨»ï¼šè‹¥é¸å–®ç„¡æ‚¨çš„å“é …ï¼Œè«‹é»æœ€ä¸‹æ–¹ã€Œè‡ªè¡Œè¼¸å…¥ã€</p>
                
                <label>äººå“¡é¸æ“‡</label>
                <select id="personSelect" onchange="toggleManual('manualName', this.value === 'å…¶ä»–')">
                    <option value="è©©å±è€å¸«">è©©å±è€å¸«</option><option value="å²³éœ–è€å¸«">å²³éœ–è€å¸«</option>
                    <option value="é›…å©·è€å¸«">é›…å©·è€å¸«</option><option value="ä¸»ä»»">ä¸»ä»»</option>
                    <option value="å¼·å“¥">å¼·å“¥</option><option value="åŠ©æ•™">åŠ©æ•™</option>
                    <option value="å…¶ä»–">å…¶ä»– (è‡ªè¡Œè¼¸å…¥)</option>
                </select>
                <input type="text" id="manualName" placeholder="è«‹è¼¸å…¥å§“å" style="display:none;">

                <label>å“é …é¸æ“‡</label>
                <select id="itemSelect" onchange="toggleManual('customItemBox', this.value === 'CUSTOM')"></select>
                <div id="customItemBox" class="custom-input-group" style="display:none;">
                    <input type="text" id="customItemName" placeholder="å“é …åç¨±">
                    <input type="number" id="customItemPrice" placeholder="åƒ¹æ ¼ (æ•¸å­—)">
                </div>

                <label>ç³–å†° / åŠ æ–™ / è¦æ ¼</label>
                <select id="toppingSelect" onchange="toggleManual('customTopBox', this.value === 'CUSTOM')"></select>
                <div id="customTopBox" class="custom-input-group" style="display:none;">
                    <input type="text" id="customTopName" placeholder="è¦æ ¼å‚™è¨» (å¦‚:å»å†°ç„¡ç³–)">
                    <input type="number" id="customTopPrice" placeholder="åŠ åƒ¹(ä¸åŠ åƒ¹å¡«0)">
                </div>

                <button style="width:100%; padding:18px; background:var(--primary-cyan); color:white; border:none; border-radius:12px; font-weight:bold; cursor:pointer;" onclick="sendOrder()">ğŸš€ é€å‡ºé»é¤ (å³æ™‚æ›´æ–°ä¸»è¢å¹•)</button>
            </div>
            <div class="display-panel" id="orderDisplay"></div>
        </div>
        <div class="total-banner">å…¨ç­ç¸½é‡‘é¡ï¼š$<span id="totalPrice">0</span></div>
    </div>

    <div class="qr-section" id="qrSection">
        <h3>ğŸ“± æ‰‹æ©Ÿé»é¤å…¥å£</h3>
        <div id="qrcode" style="display: flex; justify-content: center;"></div>
        <p style="font-size:0.8rem; color:#666; margin-top:10px;">è®“åŒå­¸æƒæå¾Œï¼Œæ‰‹æ©Ÿå°‡é–å®šæ‚¨é¸å®šçš„åº—å®¶</p>
    </div>
</div>

<div class="footer-bar">
    <button style="background:var(--primary-purple); color:white; border:none; padding:10px 20px; border-radius:8px; font-weight:bold;" onclick="copyLine()">ğŸ“‹ è¤‡è£½ LINE çµ±è¨ˆ</button>
    <button style="background:#ef4444; color:white; border:none; padding:10px 20px; border-radius:8px; font-weight:bold;" onclick="clearAll()">âš ï¸ æ¸…ç©ºé‡æ•´</button>
</div>

<script>
// --- ğŸ”¥ Firebase æ ¸å¿ƒé…ç½® (å·²ä¿®æ­£ databaseURL) ---
const firebaseConfig = {
  apiKey: "AIzaSyC5kL_EtZ5njzrVF91_AX5GlqZDm7Y4gkg",
  authDomain: "bvjvj-a2b27.firebaseapp.com",
  databaseURL: "https://bvjvj-a2b27-default-rtdb.firebaseio.com", 
  projectId: "bvjvj-a2b27",
  storageBucket: "bvjvj-a2b27.firebasestorage.app",
  messagingSenderId: "5684762832",
  appId: "1:5684762832:web:e324f0c906e4b0313526d5",
  measurementId: "G-1XDKY396FP"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// --- 22 å®¶åº—åœ°æ¯¯å¼å…¨å“é …æ•¸æ“šåº« ---
const storesData = {
    "50åµ #åŸºéš†æ·±æºª": { menu: {"é˜¿è–©å§†ç´…èŒ¶":40,"èŒ‰è‰ç¶ èŒ¶":40,"å››å­£æ˜¥é’èŒ¶":40,"é»ƒé‡‘çƒé¾":40,"æª¸æª¬ç´…":60,"8å†°ç¶ ":60,"é¤Šæ¨‚å¤šç¶ ":60,"å¥¶èŒ¶":60,"çƒé¾å¥¶èŒ¶":60,"å¸ƒä¸å¥¶èŒ¶":75,"æ³¢éœ¸å¥¶èŒ¶":60,"çç å¥¶èŒ¶":60,"ç‡•éº¥å¥¶èŒ¶":60,"ç´…èŒ¶ç‘ªå¥‡æœµ":60,"æ³¢éœ¸ç´…èŒ¶æ‹¿éµ":70,"å†°æ·‡æ·‹ç´…èŒ¶":60,"éºµèŒ¶å¥¶èŒ¶":75,"ä»™è‰å¥¶å‡":60}, toppings: {"æ­£å¸¸ç³–å†°":0,"åŠç³–":0,"å¾®ç³–":0,"ç„¡ç³–":0,"å»å†°":0,"å¸ƒä¸(2é¡†)+20":20,"ä»™è‰å‡+10":10,"ç‡•éº¥+10":10} },
    "å¾—æ­£ #åŸºéš†æµ·å¤§": { menu: {"æ˜¥çƒé¾":30,"è¼•çƒé¾":30,"ç„™çƒé¾":30,"ç·‹çƒé¾":35,"æª¸æª¬æ˜¥çƒé¾":55,"å„ªé¦™é®®å¥¶èŒ¶":60,"ç„™çƒé¾å¥¶èŒ¶":50,"ç´…èŒ¶é®®å¥¶":55,"çç å¥¶èŒ¶":55,"èŠå£«å¥¶è“‹æ˜¥çƒé¾":50,"æŠ¹èŒ¶é®®å¥¶":65}, toppings: {"æ­£å¸¸":0,"å®Œå…¨å»å†°":0,"å¸¸æº«":0,"æº«é£²":0,"èŒ¶å‡+10":10,"é»ƒé‡‘çç +10":10,"èŠå£«å¥¶è“‹+20":20} },
    "å»–åª½åª½éºµé£¯é¤¨-æ–°è±åº—": { menu: {"æ‰“æ‹‹è±¬ç‚’é£¯":120,"æšå·ç‚’é£¯":105,"é’æ¤’ç‰›è‚‰ç‚’é£¯":105,"è¦ä»ç‚’é£¯":105,"é³³æ¢¨ç‚’é£¯":105,"åª½åª½ç‚’é£¯":95,"ç«è…¿ç‚’é£¯":90,"è‚‰çµ²ç‚’é£¯":90,"å’Œé¢¨è¦ªå­ä¸¼":125,"éº»å©†è±†è…ç‡´é£¯":115,"æµ·é®®ç‡´é£¯":120,"è•ƒèŒ„æ»‘è›‹ç‡´é£¯":120,"é’æ¤’ç‰›è‚‰ç‡´é£¯":105,"æ»‘è›‹ç‰›è‚‰ç‡´é£¯":110,"æ²™èŒ¶ç¾Šè‚‰ç‡´é£¯":105,"ä»€éŒ¦æµ·é®®ç‡´é£¯":110,"é³³æ¢¨ç‰›è‚‰ç‡´é£¯":110,"è¦ä»ç‡´é£¯":105,"é›è‚‰ç‡´é£¯":105,"è±¬è‚‰ç‡´é£¯":100,"ç‚’å¤§é™³å¹´ç³•":130,"ç‰›è‚‰ç‚’éºµ":105,"è‚‰çµ²ç‚’éºµ":90,"ä»€éŒ¦æ¹¯éºµ":110,"è”¥è›‹":110,"ç‚’é’èœ":70}, toppings: {"æ­£å¸¸":0,"åŠ éºµ/é£¯+20":20,"åŠ è›‹+15":15,"åŠ å¹´ç³•+35":35} },
    "é‚±è¨˜ç‚’éºµï¼ˆæ±ä¿¡åº—ï¼‰": { menu: {"ç´ ç‚’é£¯":75,"è›‹ç‚’é£¯":75,"è‚‰çµ²ç‚’é£¯":75,"è¦ä»ç‚’é£¯":90,"æ»·è‚‰é£¯(å¤§)":45,"ç´ é£Ÿéºµ":75,"è‚‰çµ²éºµ":75,"è›¤èœŠéºµ":90,"é®®è¦éºµ":90,"è‚‰ç‰‡éºµ":90,"è±¬è‚éºµ":90,"ä»€éŒ¦éºµ":90,"èšµä»”éºµ":110,"æµ·é®®éºµ":110,"è›‹èŠ±æ¹¯":30,"è›¤èœŠæ¹¯":50,"ç¶œåˆæ»·å‘³":40,"çš®è›‹è±†è…":45}, toppings: {"æ²¹éºµ":0,"ç±³ç²‰":0,"çƒé¾":0,"å†¬ç²‰":0,"ç²„æ¢":0,"å¹´ç³•":0,"ç²¥":0,"å’–å“©å£å‘³+5":5} },
    "å¤§ç¢—ç‰›è‚‰éºµ": { menu: {"ç‰›è‚‰éºµ(å°)":130,"ç‰›è‚‰éºµ(å¤§)":170,"ç‰›è‚‰ä¹¾éºµ(å°)":130,"ç‰›è‚‰ä¹¾éºµ(å¤§)":170,"ç‰›è‚‰å†¬ç²‰":130,"ç‰›è‚‰æ¹¯éºµ":80,"ç‰›è‚‰æ¹¯é¤ƒ":110,"æ°´é¤ƒ(10é¡†)":70,"é…¢é†¬éºµ":80,"ç‰¹è£½æ¶¼éºµ":60,"ç´…æ²¹æŠ„æ‰‹":80,"ç‰›è…±è‚‰":80,"èŠ±å¹²":35}, toppings: {"æ­£å¸¸":0,"åŠ å¤§+20":20} },
    "éº¥å…‹éºµç·š": { menu: {"éºµç·šç„¿(å°)":45,"éºµç·šç„¿(å¤§)":65,"å…¨ç„¿(å°)":70,"å…¨ç„¿(å¤§)":120,"èšµä»”ç…":65,"è¦ä»ç…":65,"è‚‰åœ“":40}, toppings: {"æ­£å¸¸":0} },
    "è±†ä¹¾åŒ…ç¥¥è±è¡—": { menu: {"è±†å¹²åŒ…(2å€‹)":50,"ç‚’éºµ(å°)":35,"ç‚’éºµ(å¤§)":50,"ç‚’ç±³ç²‰(å°)":35,"ç‚’ç±³ç²‰(å¤§)":50,"æ‹›ç‰Œæ¹¯":65,"ç¶œåˆæ¹¯":50,"é­šä¸¸æ¹¯":50,"é­·é­šç„¿":50,"ä¹¾éºµ":35,"å†¬ç²‰æ¹¯":35,"è±†å¹²åŒ…(8å€‹ç›’è£)":140}, toppings: {"æ­£å¸¸":0} },
    "ç¾é¦™é½‹æ»·å‘³": { menu: {"å¥—é¤ SET A":190,"å¥—é¤ SET B":195,"å¥—é¤ SET C":195,"æ»·å‘³æ‹¼ç›¤":100,"æ°´é¤ƒ(10é¡†)":60,"ä¹¾æ‹Œéºµ":50}, toppings: {"æ­£å¸¸":0,"åŠ è¾£":0} },
    "è’Ÿè’»å±‹": { menu: {"ç¶œåˆå‰‰å†°":85,"æ—¥å¼é‡‘æ™‚å†°":90,"ç´…è±†ç‰›å¥¶å†°":95,"è’Ÿè’»ç¶ è±†æ¹¯":50,"è’Ÿè’»ç´…è±†æ¹¯":55,"è’Ÿè’»æœ‰æ©Ÿè±†èŠ±":45,"ç¾äººæ¹¯":70,"é¦™é›æ’":85,"é›è…¿":90,"ç‚¸æ¹¯åœ“":30,"æœˆäº®è¦é¤…":45}, toppings: {"å†·":0,"ç†±":0,"åŠ é…æ–™+10":10} },
    "é¶´èŒ¶æ¨“": { menu: {"é¶´é ‚ç´…èŒ¶":35,"ç¶ºå¤¢é‚£å ¤":60,"ç¥è¾²ç‰›ä¹³":65,"æ³°å¼å¥¶èŒ¶":65,"ç²‰ç²¿å¥¶èŒ¶":60,"é»‘ç³–çç å¥¶èŒ¶":65,"è”æç´…èŒ¶":50}, toppings: {"æ­£å¸¸":0,"å®Œå…¨å»å†°":0,"å¾®ç³–":0,"æä»å‡+15":15,"ç²‰ç²¿+15":15} },
    "å¯ä¸å¯ #åŸºéš†æ·±æºª": { menu: {"ç†Ÿæˆç´…èŒ¶":35,"èƒ­è„‚ç´…èŒ¶":40,"ç™½ç‰æ­è•¾":60,"ç†Ÿæˆæ­è•¾":55,"èƒ­è„‚é‚£å ¤":60,"é‡‘é‘½é³³æ¢¨ç¶ ":60}, toppings: {"æ­£å¸¸":0,"ç™½ç‰+10":10,"æ°´ç‰+10":10} },
    "æ‹¾æ±£èŒ¶å±‹": { menu: {"æ„›ç‰å…¬çˆµ":45,"çç é®®å¥¶èŒ¶":60,"ç´”èŒ¶":30,"ç²‰ç²¿æ¡‚èŠ±":45,"æ‹¾æ±£å¥¶èŒ¶":45,"å†¬ç“œèŒ¶":30,"ç”˜è”—é’èŒ¶":55}, toppings: {"æ­£å¸¸":0,"ç²‰ç²¿+10":10,"çç +10":10} },
    "è¿·å®¢å¤": { menu: {"çç é®®å¥¶":75,"ä¼¯çˆµæ‹¿éµ":65,"å¤§ç”²èŠ‹é ­é®®å¥¶":80,"é’èŒ¶":30,"åˆéœ²ç¶ èŒ¶":30,"ç¥ç€æ‹¿éµ":65}, toppings: {"æ­£å¸¸":0,"ç™½ç‰çç +10":10} },
    "é¾œè¨˜": { menu: {"ç´…æŸšç¿¡ç¿ ":75,"è˜‹æœç´…è±":55,"ä¸‰åå››è™Ÿç´…èŒ¶":40,"ä¸‰éŸ»å¥¶èŒ¶":55,"å†¬ç“œé®®ä¹³":65,"ç§€èŠæ¯":65}, toppings: {"æ­£å¸¸":0,"çç +10":10} },
    "æ¸…å¿ƒç¦å…¨ #æµ·å¤§": { menu: {"çƒé¾ç¶ èŒ¶":30,"å„ªå¤šç¶ èŒ¶":45,"éš±è—ç‰ˆ":50,"çç å¥¶èŒ¶":50,"éŒ«è˜­ç´…èŒ¶":30,"ä»™è‰å‡å¥¶èŒ¶":50}, toppings: {"æ­£å¸¸":0,"çç +10":10,"å¸ƒä¸+20":20} },
    "äº”æ¡è™Ÿ": { menu: {"äº”æ¡èŒ¶":35,"æä»å‡äº”æ¡èŒ¶":45,"ç¶ èŒ¶å‡äº”æ¡èŒ¶":45,"é’èŒ¶å‡äº”æ¡èŒ¶":45,"è€å¯¦äººç´…èŒ¶":35,"äº”æ¡å¥¶èŒ¶":50}, toppings: {"æ­£å¸¸":0,"èŒ¶å‡+10":10} },
    "æœ‰é£²": { menu: {"æ—ºæ—ºä¾†æ°´æœèŒ¶":65,"ç²‰ç²¿ç´…":40,"ç„¦ç³–æ‹¿éµ":75,"æŸ³æ©™ç¶ èŒ¶":60,"æ†¨å‰å¥¶éœœ":70,"çç é®®å¥¶èŒ¶":65}, toppings: {"æ­£å¸¸":0,"ç²‰ç²¿+10":10} },
    "æ—é¦™æª¸": { menu: {"æ‹›ç‰Œæª¸æª¬èŒ¶":55,"ç¶ å¦æª¸æª¬èŒ¶":55,"æ³°å¼æª¸æª¬èŒ¶":60,"é´¨å±é¦™æª¸æª¬èŒ¶":65,"é»‘é‡‘æª¸æª¬èŒ¶":60}, toppings: {"æ­£å¸¸":0} },
    "Mr.Wish": { menu: {"æ°´æœèŒ¶":60,"å…‰æœèŒ¶":65,"çç å¥¶èŒ¶":50,"æ„›æ–‡èŠ’æœå†°æ²™":85,"é‡è“çº–æœé£²":65}, toppings: {"æ­£å¸¸":0,"çç +10":10,"æ„›ç‰+10":10} },
    "Coco #åŸºéš†æµ·æ´‹": { menu: {"å¥¶èŒ¶ä¸‰å…„å¼Ÿ":55,"ç™¾é¦™é›™éŸ¿ç‚®":50,"æ˜Ÿç©ºè‘¡è„":75,"èŠåœ’ç´…èŒ¶":35,"èŠ‹é ­ç‰›å¥¶":70}, toppings: {"æ­£å¸¸":0,"çç +10":10,"å¸ƒä¸+15":15} },
    "Comebuy #æ–°è±": { menu: {"æµ·ç¥":40,"è˜‹æœå†°èŒ¶":55,"çµ•ä»£é›™Qå¥¶èŒ¶":55,"çº–ç¾å°ç´«è˜‡":50,"ç©ç«":40}, toppings: {"æ­£å¸¸":0,"çç +10":10,"ç²‰æ¢+10":10} },
    "æ°´é›²å ‚ #ç¾©äºŒåº—": { menu: {"é»‘ç³–çç é®®å¥¶":65,"ç´”èŒ¶":30,"æ°´æœèŒ¶":60,"èŠå£«å¥¶è“‹ç´…èŒ¶":60,"é‡‘é‘½é³³æ¢¨ç¶ ":60,"ç«ç‘°æ‹¿éµ":65}, toppings: {"æ­£å¸¸":0,"çç +10":10,"ä»™è‰+10":10} }
};

let currentStore = "å»–åª½åª½éºµé£¯é¤¨-æ–°è±åº—";
let isHost = !window.location.search.includes("mode=client");

function init() {
    const grid = document.getElementById('storeSelector');
    if (!isHost) {
        document.getElementById('hostOnlyControls').style.display = 'none';
        document.getElementById('qrSection').style.display = 'none';
    }
    Object.keys(storesData).sort((a,b)=>a.localeCompare(b,'zh-Hant')).forEach(name => {
        grid.innerHTML += `<div class="store-card" id="btn-${name}" onclick="setStore('${name}', true)">${name}</div>`;
    });
    db.ref('activeStore').on('value', (snap) => setStore(snap.val() || "å»–åª½åª½éºµé£¯é¤¨-æ–°è±åº—", false));
    db.ref('orders').on('value', (snap) => renderOrders(snap.val()));
    new QRCode(document.getElementById("qrcode"), { text: window.location.href.split('?')[0] + "?mode=client", width: 150, height: 150 });
}

function setStore(name, updateDb) {
    currentStore = name;
    document.querySelectorAll('.store-card').forEach(c => c.classList.remove('active'));
    if(document.getElementById(`btn-${name}`)) document.getElementById(`btn-${name}`).classList.add('active');
    const s = storesData[name];
    document.getElementById('targetStoreTitle').innerText = `æ­£åœ¨é»é¤ï¼š${name}`;
    let itemHtml = Object.keys(s.menu).sort().map(k => `<option value="${k}">${k} ($${s.menu[k]})</option>`).join('');
    itemHtml += `<option value="CUSTOM" style="color:red; font-weight:bold;">âœ¨ è‡ªè¡Œè¼¸å…¥å“é … âœ¨</option>`;
    document.getElementById('itemSelect').innerHTML = itemHtml;
    let topHtml = Object.keys(s.toppings).map(k => `<option value="${k}">${k} (+$${s.toppings[k]})</option>`).join('');
    topHtml += `<option value="CUSTOM" style="color:red; font-weight:bold;">âœ¨ è‡ªè¡Œè¼¸å…¥è¦æ ¼/åŠ åƒ¹ âœ¨</option>`;
    document.getElementById('toppingSelect').innerHTML = topHtml;
    if (isHost && updateDb) db.ref('activeStore').set(name);
}

function toggleManual(id, show) { document.getElementById(id).style.display = show ? 'block' : 'none'; }

function sendOrder() {
    let name = document.getElementById('personSelect').value;
    if (name === 'å…¶ä»–') name = document.getElementById('manualName').value;
    if (!name) return alert("è«‹è¼¸å…¥å§“åï¼");
    let item, itemPrice, top, topPrice;
    if (document.getElementById('itemSelect').value === 'CUSTOM') {
        item = document.getElementById('customItemName').value;
        itemPrice = parseInt(document.getElementById('customItemPrice').value) || 0;
        if (!item) return alert("è«‹è¼¸å…¥å“é …åç¨±ï¼");
    } else {
        item = document.getElementById('itemSelect').value;
        itemPrice = storesData[currentStore].menu[item];
    }
    if (document.getElementById('toppingSelect').value === 'CUSTOM') {
        top = document.getElementById('customTopName').value;
        topPrice = parseInt(document.getElementById('customTopPrice').value) || 0;
        if (!top) return alert("è«‹è¼¸å…¥è¦æ ¼å‚™è¨»ï¼");
    } else {
        top = document.getElementById('toppingSelect').value;
        topPrice = storesData[currentStore].toppings[top];
    }
    db.ref('orders').push({ name, item, top, price: itemPrice + topPrice, store: currentStore });
    alert("é»é¤æˆåŠŸï¼");
}

function renderOrders(data) {
    const container = document.getElementById('orderDisplay');
    container.innerHTML = '';
    let total = 0;
    if(data) {
        Object.keys(data).forEach(key => {
            const o = data[key];
            total += o.price;
            container.innerHTML += `
                <div class="stats-list-card">
                    <b>ğŸ‘¤ ${o.name}</b> <span style="float:right; font-weight:900; color:var(--primary-purple);">$${o.price}</span><br>
                    <small>ğŸ“ ${o.store.split(' ')[0]}</small><br>
                    <span>${o.item}</span><br>
                    <small style="color:#666">${o.top}</small>
                    ${isHost ? `<button onclick="db.ref('orders/${key}').remove()" style="position:absolute; bottom:5px; right:5px; color:red; border:none; background:none; cursor:pointer;">âŒ</button>` : ''}
                </div>`;
        });
    }
    document.getElementById('totalPrice').innerText = total;
}

function copyLine() {
    db.ref('orders').once('value', (snap) => {
        const data = snap.val();
        if(!data) return alert("å°šç„¡è¨‚å–®");
        let msg = `ğŸ“‹ ã€é›»æ©Ÿç§‘æ™ºæ…§é»é¤å›å ±ã€‘\nğŸ“ åº—å®¶ï¼š${currentStore}\n----------------------\n`;
        Object.values(data).forEach(o => { msg += `ğŸ‘¤ ${o.name}: ${o.item} (${o.top}) $${o.price}\n`; });
        msg += `----------------------\nğŸ”¥ ç¸½é‡‘é¡ï¼š$${document.getElementById('totalPrice').innerText}`;
        navigator.clipboard.writeText(msg); alert("å·²è¤‡è£½ï¼");
    });
}
function clearAll() { if(confirm("ç¢ºå®šæ¸…ç©ºæ‰€æœ‰è¨‚å–®å—ï¼Ÿ")) db.ref('orders').remove(); }
window.onload = init;
</script>
</body>
</html>

