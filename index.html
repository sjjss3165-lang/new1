<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›»æ©Ÿç§‘ç²¾æº–é»é¤ç³»çµ± Pro (åº—å®¶é€£å‹•ç‰ˆ)</title>
    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; --card: #ffffff; --text: #1e293b; }
        body { font-family: "Microsoft JhengHei", sans-serif; background: var(--bg); color: var(--text); padding: 15px; }
        .container { max-width: 1100px; margin: 0 auto; }
        .header { background: linear-gradient(135deg, #1e3a8a, #2563eb); color: white; padding: 25px; border-radius: 12px; margin-bottom: 20px; text-align: center; }
        .setup-section { background: var(--card); padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #e2e8f0; display: flex; align-items: center; gap: 15px; }
        table { width: 100%; border-collapse: collapse; background: var(--card); border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #f1f5f9; }
        th { background: #f8fafc; color: #64748b; font-size: 0.9rem; text-transform: uppercase; }
        .order-row { transition: background 0.2s; }
        .order-row:hover { background: #fdfdfd; }
        select, input { padding: 8px; border: 1px solid #cbd5e1; border-radius: 6px; outline: none; }
        select:focus { border-color: var(--primary); }
        .btn { cursor: pointer; border: none; border-radius: 6px; padding: 10px 20px; font-weight: 600; transition: 0.3s; }
        .btn-add { background: #10b981; color: white; }
        .btn-person { background: #2563eb; color: white; margin-top: 15px; }
        .btn-copy { background: #1e293b; color: white; width: 100%; margin-top: 25px; padding: 15px; font-size: 1.1rem; }
        .price-total { font-size: 24px; color: #ef4444; font-weight: 800; }
        .sub-item { display: grid; grid-template-columns: 1.5fr 1fr 1fr 1.2fr auto; gap: 8px; margin-bottom: 10px; align-items: center; background: #f1f5f9; padding: 8px; border-radius: 8px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1 style="margin:0;">é›»æ©Ÿç§‘ç²¾æº–é»é¤ç³»çµ± ğŸ‘©ğŸ¼â€ğŸ³</h1>
        <p style="margin:5px 0 0 0; opacity: 0.8;">åº—å®¶é€£å‹•é¸å–® | å‹•æ…‹åŠ æ–™åƒ¹æ ¼ | å€‹äººé‡‘é¡è‡ªå‹•ç´¯åŠ </p>
    </div>

    <div class="setup-section">
        <strong>ğŸ“ ç›®å‰åº—å®¶ï¼š</strong>
        <select id="storeSelect" onchange="handleStoreChange()" style="font-size: 1.1rem; font-weight: bold; color: var(--primary);">
            <option value="">è«‹é¸æ“‡å•†åº—...</option>
        </select>
        <span id="storeDetails" style="color: #64748b; font-size: 0.9rem;"></span>
    </div>

    <table id="orderTable">
        <thead>
            <tr>
                <th width="15%">è¨‚è³¼äºº</th>
                <th width="55%">å“é … / ç”œåº¦å†°å¡Š / åº—å®¶å°ˆå±¬åŠ æ–™</th>
                <th width="15%">å€‹äººå°è¨ˆ</th>
                <th width="15%">æ”¶éŒ¢èˆ‡æ‰¾éŒ¢</th>
            </tr>
        </thead>
        <tbody id="orderBody"></tbody>
    </table>

    <button class="btn btn-person" onclick="addNewPerson()">ğŸ‘¤ æ–°å¢è¨‚é¤åŒå­¸ / è€å¸«</button>

    <div style="margin-top: 30px; background: #fff; padding: 20px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #e2e8f0;">
        <div>å…¨ç­å…±ï¼š<span id="totalCount" style="font-weight: bold; font-size: 1.2rem;">0</span> æ¯ / ä»½</div>
        <div>æ‡‰æ”¶ç¸½é‡‘é¡ï¼š<span id="grandTotal" class="price-total">$0</span></div>
    </div>

    <button class="btn btn-copy" onclick="copyToLine()">ğŸ“‹ è¤‡è£½ LINE çµ±è¨ˆæ ¼å¼ (å«æ¯äººæ˜ç´°)</button>
</div>

<script>
// --- ç²¾æº–é€£å‹•è³‡æ–™åº« (22å®¶åº—å“é …èˆ‡å°ˆå±¬åŠ æ–™) ---
const storeConfig = {
    "å¾—æ­£ #åŸºéš†æµ·å¤§": {
        menu: {"æ˜¥èŒ¶": 35, "ç„™çƒé¾": 35, "æª¸æª¬æ˜¥èŒ¶": 50, "èŠå£«å¥¶è“‹æ˜¥èŒ¶": 65, "çç å¥¶èŒ¶": 55},
        toppings: {"ä¸åŠ æ–™": 0, "ç„™çƒé¾èŒ¶å‡": 10, "é»ƒé‡‘çç ": 10, "èŠå£«å¥¶è“‹": 20}
    },
    "50åµ åŸºéš†æ·±æºªåº—": {
        menu: {"å››å­£æ˜¥": 30, "çå¥¶": 50, "æ³¢éœ¸å¥¶èŒ¶": 50, "ç´…èŒ¶æ‹¿éµ": 60, "å†°æ·‡æ·‹ç´…èŒ¶": 50},
        toppings: {"ä¸åŠ æ–™": 0, "æ³¢éœ¸": 0, "çç ": 0, "æ³¢éœ¸+çç ": 0, "å¸ƒä¸(å…©é¡†)": 20}
    },
    "æ‹¾æ±£èŒ¶å±‹ åŸºéš†å»Ÿå£åº—": {
        menu: {"ç´”èŒ¶": 30, "çç é®®å¥¶èŒ¶": 60, "æ„›ç‰å…¬çˆµ": 45, "ç´…æŸšç¿ ç‰": 55},
        toppings: {"ä¸åŠ æ–™": 0, "ç²‰ç²¿": 10, "çç ": 10, "æ„›ç‰": 10}
    },
    "å¯ä¸å¯ åŸºéš†æ·±æºªåº—": {
        menu: {"ç†Ÿæˆç´…èŒ¶": 35, "èƒ­è„‚ç´…èŒ¶": 40, "ç†Ÿæˆå¥¶èŒ¶": 50, "æ˜¥èŠ½ç¶ èŒ¶": 35},
        toppings: {"ä¸åŠ æ–™": 0, "ç™½ç‰çç ": 10, "æ°´ç‰(å¯’å¤©)": 10}
    },
    "è’Ÿè’»å±‹": {
        menu: {"ç¶ è±†æ¹¯": 55, "ç¶œåˆè’Ÿè’»": 70, "ç´…è±†æ¹¯": 55, "èŠ±ç”Ÿæ¹¯": 55, "è±†èŠ±": 45},
        toppings: {"åŸå‘³": 0, "åŠ çç ": 5, "åŠ ç´…è±†": 10, "åŠ ç…‰ä¹³": 10}
    },
    "è¿·å®¢å¤ åŸºéš†å»Ÿå£åº—": {
        menu: {"çç é®®å¥¶": 70, "ç„™èŒ¶æ‹¿éµ": 65, "é’èŒ¶": 30, "å¤§ç”²èŠ‹é ­é®®å¥¶": 75},
        toppings: {"ä¸åŠ æ–™": 0, "ç™½ç‰çç ": 10, "é»ƒé‡‘çç ": 10, "ä»™è‰å‡": 10}
    },
    "æ‹¾æ±£èŒ¶å±‹": {
        menu: {"æ„›ç‰å…¬çˆµ": 45, "çç é®®å¥¶èŒ¶": 60, "ç´”èŒ¶": 30},
        toppings: {"ä¸åŠ æ–™": 0, "ç²‰ç²¿": 10, "çˆ†çˆ†ç ": 15}
    }
    // å…¶é¤˜åº—å®¶å¯ä¾æ­¤æ ¼å¼è£œé½Š...
};

let orders = JSON.parse(localStorage.getItem('smart_orders')) || [];

function init() {
    const select = document.getElementById('storeSelect');
    Object.keys(storeConfig).forEach(name => select.add(new Option(name, name)));
    render();
}

function handleStoreChange() {
    if(confirm("åˆ‡æ›åº—å®¶æœƒæ¸…ç©ºç›®å‰æ‰€æœ‰äººçš„å“é …é¸æ“‡ï¼ˆé¿å…åƒ¹æ ¼å‡ºéŒ¯ï¼‰ï¼Œç¢ºå®šå—ï¼Ÿ")) {
        orders.forEach(p => p.items = [{ drink: "", sugar: "æ­£å¸¸", ice: "æ­£å¸¸", topping: "ä¸åŠ æ–™", price: 0 }]);
        save();
    }
}

function addNewPerson() {
    const name = prompt("è«‹è¼¸å…¥å§“åï¼š");
    if (!name) return;
    orders.push({ name, items: [{ drink: "", sugar: "æ­£å¸¸", ice: "æ­£å¸¸", topping: "ä¸åŠ æ–™", price: 0 }], paid: 0 });
    save();
}

function addSubItem(pIdx) {
    orders[pIdx].items.push({ drink: "", sugar: "æ­£å¸¸", ice: "æ­£å¸¸", topping: "ä¸åŠ æ–™", price: 0 });
    save();
}

function updateVal(pIdx, iIdx, field, val) {
    const store = document.getElementById('storeSelect').value;
    const item = orders[pIdx].items[iIdx];
    item[field] = val;
    
    if (store && (field === 'drink' || field === 'topping')) {
        const dPrice = storeConfig[store].menu[item.drink] || 0;
        const tPrice = storeConfig[store].toppings[item.topping] || 0;
        item.price = dPrice + tPrice;
    }
    save();
}

function save() {
    localStorage.setItem('smart_orders', JSON.stringify(orders));
    render();
}

function render() {
    const store = document.getElementById('storeSelect').value;
    const body = document.getElementById('orderBody');
    body.innerHTML = '';
    let totalAll = 0, countAll = 0;

    orders.forEach((p, pIdx) => {
        let pSum = 0;
        const itemsHtml = p.items.map((it, iIdx) => {
            pSum += it.price;
            countAll++;

            let dOpts = `<option value="">è«‹é¸æ“‡å“é …...</option>`;
            if(store) Object.keys(storeConfig[store].menu).forEach(d => dOpts += `<option value="${d}" ${it.drink===d?'selected':''}>${d} ($${storeConfig[store].menu[d]})</option>`);

            let tOpts = "";
            if(store) Object.keys(storeConfig[store].toppings).forEach(t => tOpts += `<option value="${t}" ${it.topping===t?'selected':''}>+${t} ($${storeConfig[store].toppings[t]})</option>`);

            return `
                <div class="sub-item">
                    <select onchange="updateVal(${pIdx}, ${iIdx}, 'drink', this.value)">${dOpts}</select>
                    <select onchange="updateVal(${pIdx}, ${iIdx}, 'sugar', this.value)">
                        ${["æ­£å¸¸","åŠç³–","å¾®ç³–","ç„¡ç³–"].map(s => `<option value="${s}" ${it.sugar===s?'selected':''}>${s}</option>`).join('')}
                    </select>
                    <select onchange="updateVal(${pIdx}, ${iIdx}, 'ice', this.value)">
                        ${["æ­£å¸¸","å°‘å†°","å¾®å†°","å»å†°","ç†±"].map(i => `<option value="${i}" ${it.ice===i?'selected':''}>${i}</option>`).join('')}
                    </select>
                    <select onchange="updateVal(${pIdx}, ${iIdx}, 'topping', this.value)">${tOpts}</select>
                    <span style="font-weight:bold; color:var(--primary)">$${it.price}</span>
                </div>
            `;
        }).join('');

        totalAll += pSum;
        const row = document.createElement('tr');
        row.className = "order-row";
        row.innerHTML = `
            <td><strong>${p.name}</strong></td>
            <td>${itemsHtml} <button onclick="addSubItem(${pIdx})" style="background:none; border:none; color:blue; cursor:pointer; font-size:12px;">+ å†é»ä¸€æ¯</button></td>
            <td><span class="price-tag" style="color:#2563eb">$${pSum}</span></td>
            <td>
                æ”¶: <input type="number" style="width:50px" value="${p.paid}" oninput="orders[${pIdx}].paid=this.value; save()">
                <div style="font-size:12px; color:#ef4444">æ‰¾: ${p.paid - pSum > 0 ? p.paid - pSum : 0}</div>
            </td>
        `;
        body.appendChild(row);
    });

    document.getElementById('grandTotal').innerText = `$${totalAll}`;
    document.getElementById('totalCount').innerText = countAll;
}

function copyToLine() {
    const store = document.getElementById('storeSelect').value;
    let text = `ğŸ“‹ ã€é›»æ©Ÿç§‘é»é¤çµ±è¨ˆã€‘\nğŸ“ åº—å®¶ï¼š${store}\n------------------\n`;
    orders.forEach(p => {
        let s = 0;
        text += `ğŸ‘¤ ${p.name}ï¼š\n`;
        p.items.forEach(i => {
            text += `  - ${i.drink} (${i.sugar}/${i.ice}) ${i.topping!=='ä¸åŠ æ–™'?' +'+i.topping:''} $${i.price}\n`;
            s += i.price;
        });
        text += `  ğŸ’° å€‹äººå°è¨ˆï¼š$${s}\n`;
    });
    text += `------------------\nğŸ”¥ ç¸½è¨ˆï¼š$${document.getElementById('grandTotal').innerText}\nå…± ${document.getElementById('totalCount').innerText} æ¯`;
    navigator.clipboard.writeText(text).then(() => alert("æ‘˜è¦å·²è¤‡è£½ï¼å¯ä»¥ç›´æ¥è²¼åˆ° LINE å›‰ï¼"));
}

window.onload = init;
</script>
</body>
</html>
