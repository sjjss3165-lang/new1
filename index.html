<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>é›»æ©Ÿç§‘é»é¤ Pro - 22å®¶å…¨ç‡Ÿæ¥­æ™‚é–“ç‰ˆ</title>
    <style>
        :root { --primary: #0056b3; --dark: #1e293b; }
        body { font-family: "Microsoft JhengHei", sans-serif; background: #f0f2f5; margin: 0; padding: 15px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 16px; box-shadow: 0 8px 30px rgba(0,0,0,0.1); }
        
        /* å•†åº—å¤§æ ¼å­ä»‹é¢ */
        .store-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 12px; margin-bottom: 25px; }
        .store-card { padding: 15px; border: 2px solid #e2e8f0; border-radius: 12px; cursor: pointer; transition: 0.3s; position: relative; background: #fff; }
        .store-card.active { border-color: var(--primary); background: #f0f7ff; box-shadow: 0 4px 12px rgba(0,86,179,0.15); }
        .store-card h3 { margin: 0 0 8px 0; color: var(--dark); font-size: 1.1rem; }
        .store-card p { margin: 4px 0; font-size: 0.85rem; color: #64748b; line-height: 1.4; }
        .status-tag { position: absolute; top: 12px; right: 12px; font-size: 10px; padding: 2px 6px; border-radius: 4px; font-weight: bold; }

        /* å¤§è¦æ ¼æ–¹å¡Š */
        .spec-label { font-size: 1rem; color: #1e293b; margin: 18px 0 8px; font-weight: bold; border-left: 4px solid var(--primary); padding-left: 8px; }
        .spec-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 15px; }
        .spec-item { border: 2px solid #cbd5e1; color: #475569; padding: 12px 5px; border-radius: 10px; cursor: pointer; font-size: 14px; text-align: center; font-weight: bold; transition: 0.2s; }
        .spec-item.selected { border-color: var(--primary); background: var(--primary); color: white; }

        /* è¨‚å–®å¡ç‰‡ */
        .person-card { border: 1px solid #e2e8f0; border-top: 6px solid var(--primary); border-radius: 15px; padding: 20px; margin-bottom: 25px; background: #fff; }
        .item-box { background: #f8fafc; padding: 18px; border-radius: 12px; margin-bottom: 15px; border: 1px solid #edf2f7; }
        select { width: 100%; padding: 14px; border-radius: 10px; border: 2px solid #cbd5e1; font-size: 1.1rem; appearance: none; background: #fff; }
        
        .footer { position: sticky; bottom: 0; background: var(--dark); color: white; padding: 20px; border-radius: 15px 15px 0 0; display: flex; justify-content: space-between; align-items: center; z-index: 100; }
        .btn-copy { width: 100%; padding: 18px; background: #2563eb; color: white; border: none; font-size: 1.2rem; font-weight: bold; cursor: pointer; border-radius: 0 0 15px 15px; }
    </style>
</head>
<body>

<div class="container">
    <h1 style="text-align:center; color:var(--dark);">âš¡ é›»æ©Ÿç§‘æ™ºæ…§é»é¤çµ±è¨ˆ Pro</h1>
    <p style="text-align:center; color: #64748b; margin-top:-10px;">22å®¶å…¨å“é …ã€æ™‚é–“ã€é›»è©±ã€è‡ªå‹•ç®—éŒ¢ç³»çµ±</p>
    
    <div class="store-grid" id="storeSelector"></div>

    <div id="storeInfo" style="display:none; background: #f0f9ff; padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #bae6fd;">
        <strong id="activeStoreName" style="font-size:1.4rem; color:var(--primary);"></strong>
        <p id="activeStoreDetail" style="margin:5px 0; color:#0369a1;"></p>
    </div>

    <div id="mainOrderArea"></div>
    <button onclick="addPerson()" style="width:100%; padding:20px; background:#10b981; color:white; border:none; border-radius:12px; font-weight:bold; cursor:pointer; font-size: 1.2rem; margin-bottom: 80px;">â• æ–°å¢è¨‚é¤åŒå­¸</button>
</div>

<div class="footer">
    <div>ç¸½è¨ˆï¼š<span id="totalItems">0</span> ä»½</div>
    <div style="font-size:1.8rem; font-weight:bold;">æ‡‰æ”¶ç¸½é¡ï¼š$<span id="totalPrice">0</span></div>
</div>
<button class="btn-copy" onclick="copyResult()">ğŸ“‹ è¤‡è£½ LINE çµ±è¨ˆæ ¼å¼</button>

<script>
// --- å®Œæ•´ 22 å®¶åº—å®¶è³‡æ–™åº«ï¼ˆå«ç²¾ç¢ºæ™‚é–“ã€é›»è©±ã€å“é …ï¼‰ ---
const stores = {
    "å¾—æ­£ #åŸºéš†æµ·å¤§": { tel: "02-24621016", time: "11:00-21:00", off: "ç„¡", menu: {"æ˜¥çƒé¾":35, "è¼•çƒé¾":35, "ç„™çƒé¾":35, "ç·‹çƒé¾":35, "æª¸æª¬æ˜¥çƒé¾":55, "çç å¥¶èŒ¶":55, "èŠå£«å¥¶è“‹æ˜¥çƒé¾":65}, toppings: {"ä¸åŠ æ–™":0, "ç„™çƒé¾èŒ¶å‡":10, "é»ƒé‡‘çç ":10} },
    "50åµ #åŸºéš†æ·±æºª": { tel: "02-24683368", time: "10:00-22:00", off: "ç„¡", menu: {"å››å­£æ˜¥":30, "çå¥¶":50, "æ³¢éœ¸å¥¶èŒ¶":50, "ç´…èŒ¶æ‹¿éµ":60, "å…«å†°èŒ¶":50}, toppings: {"ä¸åŠ æ–™":0, "æ³¢éœ¸":0, "çç ":0} },
    "æ‹¾æ±£èŒ¶å±‹ #åŸºéš†å»Ÿå£": { tel: "02-24247778", time: "10:30-22:30", off: "ç„¡", menu: {"ç´”èŒ¶":30, "æ„›ç‰å…¬çˆµ":45, "çç é®®å¥¶èŒ¶":60, "ç²‰ç²¿æ¡‚èŠ±":45}, toppings: {"ä¸åŠ æ–™":0, "ç²‰ç²¿":10, "çç ":10} },
    "å¯ä¸å¯ #åŸºéš†æ·±æºª": { tel: "02-24659695", time: "10:00-22:00", off: "ç„¡", menu: {"ç†Ÿæˆç´…èŒ¶":35, "èƒ­è„‚ç´…èŒ¶":40, "ç™½ç‰æ­è•¾":60, "æ˜¥èŠ½ç¶ èŒ¶":35}, toppings: {"ä¸åŠ æ–™":0, "ç™½ç‰":10} },
    "è¿·å®¢å¤ #åŸºéš†å»Ÿå£": { tel: "02-24261766", time: "10:00-21:30", off: "ç„¡", menu: {"çç é®®å¥¶":75, "ä¼¯çˆµæ‹¿éµ":65, "å¤§ç”²èŠ‹é ­é®®å¥¶":80}, toppings: {"ä¸åŠ æ–™":0, "ç™½ç‰çç ":10} },
    "é¾œè¨˜ #åŸºéš†åº—": { tel: "02-24258889", time: "11:00-22:00", off: "ç„¡", menu: {"ç´…æŸšç¿¡ç¿ ":75, "è˜‹æœç´…è±":55, "ä¸‰åå››è™Ÿç´…èŒ¶":40}, toppings: {"ä¸åŠ æ–™":0, "çç ":10} },
    "äº”æ¡è™Ÿ #åŸºéš†ä»ä¸‰": { tel: "02-24283616", time: "11:00-21:30", off: "ç„¡", menu: {"äº”æ¡èŒ¶":35, "æä»å‡äº”æ¡èŒ¶":45, "è€å¯¦äººç´…èŒ¶":35}, toppings: {"ä¸åŠ æ–™":0, "ç¶ èŒ¶å‡":10} },
    "æœ‰é£² #åŸºéš†å»Ÿå£": { tel: "02-24258827", time: "11:00-21:00", off: "ç„¡", menu: {"æ—ºæ—ºä¾†æ°´æœèŒ¶":65, "ç²‰ç²¿ç´…":40}, toppings: {"ä¸åŠ æ–™":0, "ç²‰ç²¿":10} },
    "è’Ÿè’»å±‹": { tel: "02-24229000", time: "09:00-02:00", off: "ç„¡", menu: {"ç¶œåˆè’Ÿè’»":70, "ç¶ è±†æ¹¯":55, "è±†èŠ±":45}, toppings: {"åŸå‘³":0, "åŠ çç ":5, "åŠ ç´…è±†":10} },
    "æ¸…å¿ƒ #åŸºéš†æµ·å¤§": { tel: "02-24626266", time: "10:00-22:45", off: "ç„¡", menu: {"çƒé¾ç¶ èŒ¶":30, "å„ªå¤šç¶ èŒ¶":45, "éš±è—ç‰ˆ":50}, toppings: {"ä¸åŠ æ–™":0, "çç ":10} },
    "æ—é¦™æª¸ #åŸºéš†åº—": { tel: "02-24270618", time: "11:00-21:00", off: "ç„¡", menu: {"æ‹›ç‰Œæª¸æª¬èŒ¶":55, "ç¶ å¦æª¸æª¬èŒ¶":55}, toppings: {"ä¸åŠ æ–™":0} },
    "å»–åª½åª½éºµé£¯é¤¨": { tel: "02-24680789", time: "11:00-20:30", off: "é€±æ—¥", menu: {"æ’éª¨é£¯":95, "é›è…¿é£¯":105, "æ»·è‚‰é£¯":40}, toppings: {"æ­£å¸¸":0, "åŠ æ»·è›‹":15, "åŠ é£¯":10} },
    "å¤§ç¢—ç‰›è‚‰éºµ": { tel: "02-24633396", time: "11:00-20:30", off: "é€±ä¸€", menu: {"ç‰›è‚‰éºµ":150, "ä¹¾éºµ":70}, toppings: {"åŠ å¤§":20, "ä¸åŠ æ–™":0} },
    "é‚±è¨˜ç‚’éºµ": { tel: "02-24680335", time: "11:00-20:00", off: "é€±ä¸€", menu: {"ä»€éŒ¦ç‚’éºµ":85, "è‚‰çµ²ç‚’éºµ":75}, toppings: {"ä¸åŠ æ–™":0, "åŠ éºµ":10} },
    "éº¥å…‹éºµç·š": { tel: "02-24236667", time: "06:00-18:00", off: "ç„¡", menu: {"å…¨ç¾¹éºµç·š":55, "é­šé…¥éºµç·š":55}, toppings: {"åŠ å¤§":15, "ä¸åŠ æ–™":0} },
    "è±†ä¹¾åŒ… #ç¥¥è±è¡—": { tel: "02-24201711", time: "10:00-19:00", off: "é€±æ—¥", menu: {"è±†ä¹¾åŒ…æ¹¯":50, "ä¹¾éºµ":35}, toppings: {"ä¸åŠ æ–™":0} },
    "ç¾é¦™é½‹æ»·å‘³": { tel: "02-24263357", time: "11:00-23:00", off: "ç„¡", menu: {"æ»·å‘³æ‹¼ç›¤":100, "æ°´é¤ƒ(10é¡†)":60}, toppings: {"ä¸åŠ æ–™":0} },
    "Mr.Wish #åŸºéš†å»Ÿå£": { tel: "02-24273456", time: "11:00-22:00", off: "ç„¡", menu: {"æ°´æœèŒ¶":60, "å…‰æœèŒ¶":65}, toppings: {"ä¸åŠ æ–™":0, "çç ":10} },
    "Coco #åŸºéš†æµ·æ´‹": { tel: "02-24620586", time: "10:30-21:30", off: "ç„¡", menu: {"å¥¶èŒ¶ä¸‰å…„å¼Ÿ":55, "ç™¾é¦™é›™éŸ¿ç‚®":50}, toppings: {"ä¸åŠ æ–™":0} },
    "Comebuy #æ–°è±": { tel: "02-24695668", time: "10:00-22:00", off: "ç„¡", menu: {"æµ·ç¥":40, "è˜‹æœå†°èŒ¶":55}, toppings: {"ä¸åŠ æ–™":0, "ç²‰æ¢":10} },
    "é¶´èŒ¶æ¨“ #åŸºéš†å¿ ä¸€": { tel: "02-24265572", time: "10:00-22:00", off: "ç„¡", menu: {"é¶´é ‚ç´…èŒ¶":35, "æä»å‡å¥¶èŒ¶":65}, toppings: {"ä¸åŠ æ–™":0} },
    "æ°´é›²å ‚ #ç¾©äºŒåº—": { tel: "02-24261227", time: "10:00-22:00", off: "ç„¡", menu: {"é»‘ç³–çç é®®å¥¶":65, "ç´”èŒ¶":30}, toppings: {"ä¸åŠ æ–™":0} }
};

const iceLevels = ["æ­£å¸¸å†°", "å°‘å†°", "å¾®å†°", "å»å†°", "å¸¸æº«", "ç†±"];
const sugarLevels = ["æ­£å¸¸ç”œ", "9åˆ†ç”œ", "8åˆ†ç”œ", "åŠç³–", "å°‘ç³–", "å¾®ç³–", "2åˆ†ç³–", "ç„¡ç³–"];

let currentStore = "";
let orders = JSON.parse(localStorage.getItem('ee_orders_v4')) || [];

function init() {
    const selector = document.getElementById('storeSelector');
    Object.keys(stores).forEach(name => {
        const s = stores[name];
        const card = document.createElement('div');
        card.className = 'store-card';
        card.innerHTML = `
            <h3>${name}</h3>
            <p>ğŸ“ ${s.tel}</p>
            <p>â° ${s.time}</p>
            <p style="color:#ef4444; font-weight:bold;">ğŸš« å…¬ä¼‘: ${s.off}</p>
            <span class="status-tag" id="st-${name}">æª¢æ¸¬ä¸­</span>
        `;
        card.onclick = () => {
            currentStore = name;
            document.querySelectorAll('.store-card').forEach(c => c.classList.remove('active'));
            card.classList.add('active');
            document.getElementById('storeInfo').style.display = 'block';
            document.getElementById('activeStoreName').innerText = name;
            document.getElementById('activeStoreDetail').innerText = `é›»è©±ï¼š${s.tel} | æ™‚é–“ï¼š${s.time} | å…¬ä¼‘ï¼š${s.off}`;
            render();
        };
        selector.appendChild(card);
        checkStatus(name, s.time, s.off);
    });
    render();
}

function checkStatus(name, time, off) {
    const el = document.getElementById(`st-${name}`);
    const now = new Date();
    const day = now.getDay(); // 0æ˜¯é€±æ—¥
    const weekMap = {"é€±ä¸€":1, "é€±äºŒ":2, "é€±ä¸‰":3, "é€±å››":4, "é€±äº”":5, "é€±å…­":6, "é€±æ—¥":0};
    
    if(off !== "ç„¡" && day === weekMap[off]) {
        el.innerText = "ä»Šæ—¥å…¬ä¼‘"; el.style.background = "#fee2e2"; el.style.color = "#ef4444";
        return;
    }
    
    const [start, end] = time.split('-').map(t => {
        const [h, m] = t.split(':').map(Number);
        return h * 60 + m;
    });
    const cur = now.getHours() * 60 + now.getMinutes();
    if (cur >= start && cur < end) {
        el.innerText = "ç‡Ÿæ¥­ä¸­"; el.style.background = "#dcfce7"; el.style.color = "#16a34a";
    } else {
        el.innerText = "ä¼‘æ¯ä¸­"; el.style.background = "#f1f5f9"; el.style.color = "#64748b";
    }
}

function addPerson() {
    const name = prompt("è«‹è¼¸å…¥åŒå­¸å§“åï¼š");
    if (!name) return;
    orders.push({ name, items: [{ drink: "", sugar: "ç„¡ç³–", ice: "å»å†°", topping: "ä¸åŠ æ–™", price: 0 }], paid: 0 });
    save();
}

function updateOrder(pIdx, iIdx, field, val) {
    const it = orders[pIdx].items[iIdx];
    it[field] = val;
    if (currentStore && (field === 'drink' || field === 'topping')) {
        const s = stores[currentStore];
        it.price = (s.menu[it.drink] || 0) + (s.toppings[it.topping] || 0);
    }
    save();
}

function save() {
    localStorage.setItem('ee_orders_v4', JSON.stringify(orders));
    render();
}

function render() {
    const container = document.getElementById('mainOrderArea');
    container.innerHTML = '';
    let gPrice = 0, gCount = 0;
    const sData = stores[currentStore];

    orders.forEach((p, pIdx) => {
        let pSum = 0;
        const itemsHtml = p.items.map((it, iIdx) => {
            pSum += it.price; gCount++;
            let dOpts = `<option value="">-- è«‹é¸æ“‡å“é … --</option>`;
            if(sData) Object.keys(sData.menu).forEach(d => dOpts += `<option value="${d}" ${it.drink===d?'selected':''}>${d} ($${sData.menu[d]})</option>`);
            
            let iceGrid = `<div class="spec-grid">` + iceLevels.map(l => `<div class="spec-item ${it.ice===l?'selected':''}" onclick="updateOrder(${pIdx},${iIdx},'ice','${l}')">${l}</div>`).join('') + `</div>`;
            let sugarGrid = `<div class="spec-grid">` + sugarLevels.map(l => `<div class="spec-item ${it.sugar===l?'selected':''}" onclick="updateOrder(${pIdx},${iIdx},'sugar','${l}')">${l}</div>`).join('') + `</div>`;
            
            let tOpts = "";
            if(sData) Object.keys(sData.toppings).forEach(t => tOpts += `<option value="${t}" ${it.topping===t?'selected':''}>+ ${t} (+$${sData.toppings[t]})</option>`);

            return `
                <div class="item-box">
                    <select onchange="updateOrder(${pIdx},${iIdx},'drink',this.value)">${dOpts}</select>
                    <div class="spec-label">å†°åº¦</div>${iceGrid}
                    <div class="spec-label">ç”œåº¦</div>${sugarGrid}
                    <div class="spec-label">åŠ æ–™/å‚™è¨»</div>
                    <select onchange="updateOrder(${pIdx},${iIdx},'topping',this.value)">${tOpts}</select>
                    <div style="text-align:right; font-weight:bold; color:var(--primary); margin-top:10px;">å°è¨ˆï¼š$${it.price}</div>
                </div>`;
        }).join('');

        gPrice += pSum;
        container.innerHTML += `
            <div class="person-card">
                <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:2px solid #f1f5f9; padding-bottom:12px; margin-bottom:15px;">
                    <strong style="font-size:1.3rem;">ğŸ‘¤ ${p.name}</strong> 
                    <span style="color:var(--primary); font-weight:900; font-size:1.3rem;">å€‹äººç¸½è¨ˆï¼š$${pSum}</span>
                </div>
                ${itemsHtml}
                <button onclick="orders[${pIdx}].items.push({drink:'',sugar:'ç„¡ç³–',ice:'å»å†°',topping:'ä¸åŠ æ–™',price:0});render()" style="color:blue; border:none; background:none; cursor:pointer; font-weight:bold; padding:10px 0;">+ å¹«è©²åŒå­¸åŠ é»ç¬¬äºŒä»½/æ¯</button>
                <div style="margin-top:15px; background:#fff7ed; padding:15px; border-radius:10px; display:flex; justify-content:space-between; align-items:center; border:1px solid #ffedd5;">
                    <span>æ”¶ç¾é‡‘ï¼š<input type="number" style="width:70px; padding:8px; border-radius:6px; border:1px solid #ddd;" value="${p.paid}" oninput="orders[${pIdx}].paid=this.value;render()"></span>
                    <span style="color:#c2410c; font-weight:bold; font-size:1.2rem;">æ‡‰æ‰¾éŒ¢ï¼š${p.paid-pSum > 0 ? p.paid-pSum : 0} å…ƒ</span>
                    <button onclick="if(confirm('ç§»é™¤ï¼Ÿ')){orders.splice(${pIdx},1);save();}" style="color:#94a3b8; border:none; background:none; cursor:pointer; font-size:12px;">ç§»é™¤</button>
                </div>
            </div>`;
    });
    document.getElementById('totalPrice').innerText = gPrice;
    document.getElementById('totalItems').innerText = gCount;
}

function copyResult() {
    let text = `ğŸ“‹ ã€é›»æ©Ÿç§‘é»é¤çµ±è¨ˆæ‘˜è¦ã€‘\nğŸ“ åº—å®¶ï¼š${currentStore}\n------------------\n`;
    orders.forEach(p => {
        let s = 0; text += `ğŸ‘¤ ${p.name}ï¼š\n`;
        p.items.forEach(i => {
            text += `  â— ${i.drink} (${i.sugar}/${i.ice}) ${i.topping!=='ä¸åŠ æ–™'?'+'+i.topping:''} $${i.price}\n`;
            s += i.price;
        });
        text += `  ğŸ’° ç¸½è¨ˆï¼š$${s}\n------------------\n`;
    });
    text += `ğŸ”¥ å…¨ç­æ‡‰ä»˜ç¸½é‡‘é¡ï¼š$${document.getElementById('totalPrice').innerText}`;
    navigator.clipboard.writeText(text); alert("çµ±è¨ˆæ ¼å¼å·²è¤‡è£½ï¼Œè«‹ç›´æ¥è²¼åˆ° LINEï¼");
}

window.onload = init;
</script>
</body>
</html>
